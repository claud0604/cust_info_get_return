<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>APL COLOR 고객정보</title>
  <style>
    .page-container {
        width: 100%;
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        box-sizing: border-box;
    }

    .header-content {
        text-align: center;
        margin-bottom: 30px;
    }

    .header-content h1 {
        margin-bottom: 20px;
    }

    .logo {
        width: 200px;
        height: auto;
        margin: 0 auto;
        display: block;
    }

    .form-content {
        width: 100%;
    }

    .privacy-notice {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
    }

    .privacy-notice h2 {
        margin-bottom: 15px;
        font-size: 1.1rem;
    }

    .privacy-notice ul {
        padding-left: 20px;
        margin: 10px 0;
    }

    .privacy-notice li {
        margin-bottom: 8px;
        word-break: keep-all;
    }

    .privacy-content {
        border: 1px solid #ddd;
        padding: 10px;
        margin: 10px 0;
        height: 100px;
        overflow-y: auto;
        background-color: white;
    }

    .privacy-consent {
        margin-top: 15px;
        display: flex;
        align-items: center;
        padding: 0 10px;
    }

    .privacy-consent input[type="checkbox"] {
        margin: 0;
        width: 16px;
        height: 16px;
        margin-right: 20px;
    }

    .privacy-consent label {
        font-size: 14px;
        line-height: 1.5;
        flex: 1;
    }

    #customerForm {
        width: 100%;
    }

    /* 모바일 대응 */
    @media (max-width: 600px) {
        .page-container {
            padding: 15px;
        }

        .logo {
            width: 150px;
        }

        .privacy-notice {
            padding: 15px;
        }
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .logo {
      width: 50%;
      min-width: 300px;
    }
    .form-group {
      width: 100%;
      max-width: 400px;
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background-color: #45a049;
    }
    .error-message {
      color: red;
      margin-top: 10px;
      font-size: 14px;
    }
    .required::after {
      content: " *";
      color: red;
    }
    
    .radio-label {
      display: inline-flex;
      align-items: center;
      margin-right: 20px;
    }
    
    .radio-label input[type="radio"] {
      margin-right: 8px;
    }
    
    .checkbox-container {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      line-height: 1.5;
    }

    .checkbox-container input[type="checkbox"] {
      margin: 0;
      width: 16px;
      height: 16px;
    }
    
    .completion-title {
        font-size: 1.5rem;
        margin: 20px 0;
        font-weight: 500;
        text-align: center;
    }
    
    .completion-info {
        margin: 30px 0;
        padding: 25px;
        background-color: #E8D0D9;  /* 인디핑크 배경색 */
        border-radius: 8px;
        border: 1px solid #D4B5C0;  /* 테두리 색상도 맞춤 */
    }
    
    .info-item {
        margin: 15px 0;
    }
    
    .info-label {
        font-weight: bold;
        margin-right: 10px;
    }
    
    .text-content {
        margin-top: 8px;
        line-height: 1.5;
        padding-left: 10px;
    }

    /* 모바일 대응 */
    @media (max-width: 600px) {
        .completion-title {
            font-size: 1.3rem;
        }
        
        .completion-info {
            padding: 20px;
        }
    }

    .welcome-text {
        font-size: 1.8rem;  /* h1에서 h2로 크기 조정 */
        text-align: center;
        margin-bottom: 15px;
    }

    .completion-title {
        font-size: 1.5rem;
        margin: 20px 0;
        font-weight: 500;
        text-align: center;
    }

    .completion-info {
        margin: 30px 0;
        padding: 25px;
        background-color: #e9ecef;
        border-radius: 8px;
        border: 1px solid #ced4da;  /* 테두리 추가 */
    }

    .button-group {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 30px;
        margin-bottom: 50px;  /* 버튼 아래 여백 추가 */
    }

    .edit-btn, .complete-btn {
        padding: 12px 40px;
        border: none;
        border-radius: 4px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .edit-btn {
        background-color: #6c757d;
        color: white;
    }

    .complete-btn {
        background-color: #4CAF50;
        color: white;
    }

    .edit-btn:hover {
        background-color: #5a6268;
    }

    .complete-btn:hover {
        background-color: #45a049;
    }

    /* 모바일 대응 */
    @media (max-width: 600px) {
        .welcome-text {
            font-size: 1.5rem;
        }
        
        .completion-title {
            font-size: 1.2rem;
        }
        
        .edit-btn, .complete-btn {
            padding: 10px 30px;
        }
        
        .next-btn {
            margin-bottom: 40px;  /* 모바일에서는 여백 약간 줄임 */
        }
        
        .button-group {
            margin-bottom: 40px;  /* 모바일에서는 여백 약간 줄임 */
        }
    }

    .body-info-content {
        margin-top: 8px;
        line-height: 1.8;
        padding-left: 20px;
    }

    .body-info-item {
        display: block;  /* 줄바꿈을 위해 block으로 설정 */
        margin-bottom: 5px;
    }

    /* 1페이지 다음 버튼 스타일 */
    .next-btn {
        margin-bottom: 50px;  /* 버튼 아래 여백 추가 */
    }
  </style>
</head>
<body>
  <div class="page-container">
    <!-- 입력 페이지 -->
    <div id="inputPage">
        <div class="header-content">
            <h1>APL COLOR 고객정보</h1>
            <img src="./APLCOLOR_logo.png" alt="APL COLOR 로고" class="logo">
        </div>
        
        <div class="form-content">
            <div class="privacy-notice">
                <h2>개인정보 수집 및 이용 동의</h2>
                <div class="privacy-content">
                    1. 수집하는 개인정보 항목<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;• 성명, 성별, 연락처, 진단 관련 정보(예: 사이즈, 컬러 진단 결과 등).<br><br>
                    
                    2. 개인정보의 수집 및 이용목적<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;• 퍼스널 컬러 진단 서비스 제공 및 고객 맞춤형 진단 결과 제공.<br><br>
                    
                    3. 개인정보의 보유 및 이용기간<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;• 서비스 제공 완료일로부터 1년간 보관하며, 이후 즉시 파기합니다.<br><br>
                    
                    4. 동의 거부 권리 및 불이익 안내<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;• 귀하는 개인정보 수집 및 이용에 대한 동의를 거부할 권리가 있습니다. 단, 동의하지 않을 경우 퍼스널 컬러 진단 서비스 제공이 제한될 수 있습니다.
                </div>
                <div class="privacy-consent">
                    <input type="checkbox" id="privacyConsent" required>
                    <label for="privacyConsent">개인정보 수집 및 이용에 동의합니다. (필수)</label>
                </div>
            </div>

            <form id="customerForm">
                <div class="form-group">
                  <label for="date" class="required">1. 진단 날짜</label>
                  <input type="date" id="date" required>
                </div>

                <div class="form-group">
                  <label for="time" class="required">2. 진단 시간</label>
                  <input type="time" id="time" required step="1800" value="12:00">
                </div>

                <div class="form-group">
                  <label for="service" class="required">3. 예약 상품</label>
                  <select id="service" required>
                    <option value="">예약 상품을 선택해주세요</option>
                    <option value="1:1">1:1 퍼스널컬러진단</option>
                    <option value="1:2">1:2 퍼스널컬러진단</option>
                    <option value="1:3">1:3 퍼스널컬러진단</option>
                    <option value="advanced">1:1 심화진단</option>
                    <option value="fit">1:1 핏진단(체형)</option>
                    <option value="wedding">웨딩진단</option>
                    <option value="expert3">전문가 과정(3day)</option>
                    <option value="expert1">전문가 과정(1day)</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label for="name" class="required">4. 성함</label>
                  <input type="text" id="name" required placeholder="이름을 입력해주세요">
                </div>

                <div class="form-group">
                  <label class="required">5. 성별</label>
                  <div style="display: flex; gap: 20px;">
                    <label class="radio-label">
                      <input type="radio" name="gender" value="female" required>
                      여
                    </label>
                    <label class="radio-label">
                      <input type="radio" name="gender" value="male" required>
                      남
                    </label>
                  </div>
                </div>

                <div class="form-group">
                  <label for="occupation">6. 직업 (선택사항)</label>
                  <input type="text" id="occupation" placeholder="예시: 서비스직, 영업직">
                </div>

                <div class="form-group">
                  <label for="phone" class="required">7. 휴대폰 번호</label>
                  <div style="display: flex; align-items: center; gap: 5px;">
                    <span style="width: 40px;">010</span>
                    <span>-</span>
                    <input type="text" id="phoneMiddle" maxlength="4" style="width: 80px;" required>
                    <span>-</span>
                    <input type="text" id="phoneLast" maxlength="4" style="width: 80px;" required>
                  </div>
                </div>

                <div class="form-group">
                  <label>8. 신체 사이즈 (선택사항)</label>
                  <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center;">
                      <span>키:</span>
                      <input type="number" id="height" style="width: 60px; margin: 0 5px;">
                      <span>cm</span>
                    </div>
                    <div style="display: flex; align-items: center;">
                      <span>몸무게:</span>
                      <input type="number" id="weight" style="width: 60px; margin: 0 5px;">
                      <span>kg</span>
                    </div>
                    <div style="display: flex; align-items: center;">
                      <span>옷사이즈:</span>
                      <input type="text" id="clothingSize" style="width: 120px; margin: 0 5px;" placeholder="55사이즈, 95사이즈">
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label for="reason" class="required">9. 진단 의뢰이유</label>
                  <textarea id="reason" rows="3" style="width: 100%; padding: 8px;" required placeholder="간단히 작성해주셔도 됩니다"></textarea>
                </div>

                <div class="form-group">
                  <label for="stylePreference" class="required">10. 원하는 스타일링 (패션, 헤어, 메이크업등)</label>
                  <textarea id="stylePreference" rows="3" style="width: 100%; padding: 8px;" required placeholder="간단히 작성해주셔도 됩니다"></textarea>
                </div>

                <button type="button" onclick="submitForm(event)" class="next-btn">다음</button>
            </form>
        </div>
    </div>

    <!-- 확인 페이지 -->
    <div id="completionPage" style="display: none;">
        <div class="header-content">
            <h1>APL COLOR 고객정보</h1>
            <img src="./APLCOLOR_logo.png" alt="APL COLOR 로고" class="logo">
        </div>
        <h2 class="welcome-text">감사합니다 <span id="customerName"></span>님!</h2>
        <p class="completion-title">입력정보 확인후 완료버튼을 눌러주세요.</p>
        <div class="completion-info">
            <div class="info-item">
                <span class="info-label">▪ 진단날짜/시간 :</span>
                <span id="dateTime"></span>
            </div>
            <div class="info-item">
                <span class="info-label">▪ 예약상품 :</span>
                <span id="serviceInfo"></span>
            </div>
            <div class="info-item">
                <span class="info-label">▪ 고객정보</span>
                <div class="body-info-content" id="personalInfoContainer"></div>
            </div>
            <div class="info-item">
                <span class="info-label">▪ 신체정보</span>
                <div class="body-info-content" id="bodyInfo"></div>
            </div>
            <div class="info-item">
                <span class="info-label">▪ 진단 의뢰이유</span>
                <div class="text-content" id="reasonInfo"></div>
            </div>
            <div class="info-item">
                <span class="info-label">▪ 원하는 스타일링</span>
                <div class="text-content" id="stylePreferenceInfo"></div>
            </div>
        </div>
        <div class="button-group">
            <button onclick="editForm()" class="edit-btn">수정</button>
            <button onclick="completeForm()" class="complete-btn">완료</button>
        </div>
    </div>
  </div>

  <script>
    // 페이지 로드 시 맨 위로 스크롤
    window.onload = function() {
        window.scrollTo(0, 0);
        
        // 기존 코드 유지
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        const todayString = `${yyyy}-${mm}-${dd}`;
        
        const dateInput = document.getElementById('date');
        dateInput.min = todayString;
    }

    function submitForm(event) {
        event.preventDefault();
        
        // 1. 개인정보 동의 검증
        if (!document.getElementById('privacyConsent').checked) {
            alert('개인정보 수집 및 이용에 동의해주세요.');
            document.getElementById('privacyConsent').focus();
            return;
        }

        // 2. 진단 날짜 검증
        if (!document.getElementById('date').value.trim()) {
            alert('진단 날짜를 선택해주세요.');
            document.getElementById('date').focus();
            return;
        }

        // 3. 진단 시간 검증
        if (!document.getElementById('time').value.trim()) {
            alert('진단 시간을 선택해주세요.');
            document.getElementById('time').focus();
            return;
        }

        // 나머지 필수 입력 검증
        if (!document.getElementById('service').value.trim()) {
            alert('예약 상품을 선택해주세요.');
            document.getElementById('service').focus();
            return;
        }

        if (!document.getElementById('name').value.trim()) {
            alert('성함을 입력해주세요.');
            document.getElementById('name').focus();
            return;
        }

        if (!document.querySelector('input[name="gender"]:checked')) {
            alert('성별을 선택해주세요.');
            return;
        }

        const phoneMiddle = document.getElementById('phoneMiddle').value;
        const phoneLast = document.getElementById('phoneLast').value;
        
        if (!phoneMiddle) {
            alert('휴대폰 번호 중간자리를 입력해주세요.');
            document.getElementById('phoneMiddle').focus();
            return;
        }
        if (phoneMiddle.length < 4) {
            alert('휴대폰 번호 중간자리를 4자리로 입력해주세요.');
            document.getElementById('phoneMiddle').focus();
            return;
        }
        if (!phoneLast) {
            alert('휴대폰 번호 끝자리를 입력해주세요.');
            document.getElementById('phoneLast').focus();
            return;
        }
        if (phoneLast.length < 4) {
            alert('휴대폰 번호 끝자리를 4자리로 입력해주세요.');
            document.getElementById('phoneLast').focus();
            return;
        }

        if (!document.getElementById('reason').value.trim()) {
            alert('진단 의뢰이유를 입력해주세요.');
            document.getElementById('reason').focus();
            return;
        }

        if (!document.getElementById('stylePreference').value.trim()) {
            alert('원하는 스타일링을 입력해주세요.');
            document.getElementById('stylePreference').focus();
            return;
        }

        // 폼 데이터 수집 및 표시
        const formData = {
            date: document.getElementById('date').value,
            time: document.getElementById('time').value,
            service: document.getElementById('service').value,
            serviceName: document.getElementById('service').options[document.getElementById('service').selectedIndex].text,
            name: document.getElementById('name').value,
            gender: document.querySelector('input[name="gender"]:checked').value === 'male' ? '남' : '여',
            occupation: document.getElementById('occupation').value || '',
            phone: `010-${phoneMiddle}-${phoneLast}`,
            height: document.getElementById('height').value || '',
            weight: document.getElementById('weight').value || '',
            clothingSize: document.getElementById('clothingSize').value || '',
            reason: document.getElementById('reason').value,
            stylePreference: document.getElementById('stylePreference').value
        };

        // 완료 페이지 데이터 설정
        document.getElementById('customerName').textContent = formData.name;
        document.getElementById('dateTime').textContent = `${formData.date} / ${formData.time}`;
        document.getElementById('serviceInfo').textContent = formData.serviceName;

        // 고객정보 표시 방식 수정
        const personalInfoContainer = document.getElementById('personalInfoContainer');
        const personalInfoHTML = [
            `<span class="body-info-item">• 성함: ${formData.name}</span>`,
            `<span class="body-info-item">• 성별: ${formData.gender}</span>`,
            `<span class="body-info-item">• 연락처: ${formData.phone}</span>`
        ];
        
        if (formData.occupation) {
            personalInfoHTML.push(`<span class="body-info-item">• 직업: ${formData.occupation}</span>`);
        }
        
        personalInfoContainer.innerHTML = personalInfoHTML.join('');

        // 신체사이즈 정보 설정
        const bodyInfoElement = document.getElementById('bodyInfo');
        let bodyInfoHTML = '';
        
        if (formData.height) {
            bodyInfoHTML += `<span class="body-info-item">• 키: ${formData.height}cm</span>`;
        }
        if (formData.weight) {
            bodyInfoHTML += `<span class="body-info-item">• 몸무게: ${formData.weight}kg</span>`;
        }
        if (formData.clothingSize) {
            bodyInfoHTML += `<span class="body-info-item">• 옷사이즈: ${formData.clothingSize}</span>`;
        }
        
        if (bodyInfoHTML) {
            bodyInfoElement.innerHTML = bodyInfoHTML;
            bodyInfoElement.parentElement.style.display = 'block';
        } else {
            bodyInfoElement.parentElement.style.display = 'none';
        }

        document.getElementById('reasonInfo').textContent = formData.reason;
        document.getElementById('stylePreferenceInfo').textContent = formData.stylePreference;

        // 화면 전환
        document.getElementById('inputPage').style.display = 'none';
        document.getElementById('completionPage').style.display = 'block';
        
        // 맨 위로 스크롤
        window.scrollTo(0, 0);
    }

    function editForm() {
        document.getElementById('completionPage').style.display = 'none';
        document.getElementById('inputPage').style.display = 'block';
        
        // 맨 위로 스크롤
        window.scrollTo(0, 0);
    }

    async function completeForm() {
        try {
            const formData = {
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                serviceName: document.getElementById('service').options[document.getElementById('service').selectedIndex].text,
                name: document.getElementById('name').value,
                gender: document.querySelector('input[name="gender"]:checked').value,
                phone: `010-${document.getElementById('phoneMiddle').value}-${document.getElementById('phoneLast').value}`,
                occupation: document.getElementById('occupation').value,
                height: document.getElementById('height').value,
                weight: document.getElementById('weight').value,
                clothingSize: document.getElementById('clothingSize').value,
                reason: document.getElementById('reason').value,
                stylePreference: document.getElementById('stylePreference').value
            };

            console.log('Sending data:', formData);  // 전송하는 데이터 확인

            const response = await fetch('https://sm6x2p5ijl55hdjgyra2ds4tue0ieepr.lambda-url.ap-northeast-2.on.aws/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            });

            console.log('Response status:', response.status);  // 응답 상태 확인
            const responseText = await response.text();  // 응답 텍스트로 받기
            console.log('Response text:', responseText);  // 응답 내용 확인

            if (response.ok) {
                const data = JSON.parse(responseText);
                alert(data.message);  // 성공 메시지 표시
                // displayFormData 대신 alert 사용
            } else {
                throw new Error('서버 응답 오류');
            }

        } catch (error) {
            console.error('Detailed error:', error);
            alert('서버 통신 중 오류가 발생했습니다.');
        }
    }

    // 전화번호 숫자만 입력 가능하도록 설정
    document.getElementById('phoneMiddle').addEventListener('input', function(e) {
      e.target.value = e.target.value.replace(/[^0-9]/g, '');
    });

    document.getElementById('phoneLast').addEventListener('input', function(e) {
      e.target.value = e.target.value.replace(/[^0-9]/g, '');
    });
  </script>
</body>
</html>
